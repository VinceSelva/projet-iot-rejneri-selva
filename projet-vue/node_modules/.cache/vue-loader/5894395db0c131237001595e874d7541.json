{"remainingRequest":"/mnt/d/NE PAS SUPPRIMER/DESKTOP/MIAGE/M1/PROJET/projet-iot-rejneri-selva/projet-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/mnt/d/NE PAS SUPPRIMER/DESKTOP/MIAGE/M1/PROJET/projet-iot-rejneri-selva/projet-vue/src/components/Piscine.vue?vue&type=script&lang=js&","dependencies":[{"path":"/mnt/d/NE PAS SUPPRIMER/DESKTOP/MIAGE/M1/PROJET/projet-iot-rejneri-selva/projet-vue/src/components/Piscine.vue","mtime":1587764158957},{"path":"/mnt/d/NE PAS SUPPRIMER/DESKTOP/MIAGE/M1/PROJET/projet-iot-rejneri-selva/projet-vue/node_modules/cache-loader/dist/cjs.js","mtime":1587657639381},{"path":"/mnt/d/NE PAS SUPPRIMER/DESKTOP/MIAGE/M1/PROJET/projet-iot-rejneri-selva/projet-vue/node_modules/babel-loader/lib/index.js","mtime":1587657637437},{"path":"/mnt/d/NE PAS SUPPRIMER/DESKTOP/MIAGE/M1/PROJET/projet-iot-rejneri-selva/projet-vue/node_modules/cache-loader/dist/cjs.js","mtime":1587657639381},{"path":"/mnt/d/NE PAS SUPPRIMER/DESKTOP/MIAGE/M1/PROJET/projet-iot-rejneri-selva/projet-vue/node_modules/vue-loader/lib/index.js","mtime":1587657732443}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlBpc2NpbmUiLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzdGF0ZXM6IFtdLAogICAgICBsYXN0VGVtcDogbnVsbCwKICAgICAgbGFzdEx1bWlub3NpdGU6IG51bGwsCiAgICAgIGV0YXRMdW1pZXJlOiAiRXRlaW50ZSIsCiAgICAgIGV0YXRWb2xldDogIkZlcm3DqSIsCiAgICAgIG5vZGVfdXJsOiAiaHR0cDovL2xvY2FsaG9zdDozMDAwIiwKICAgICAgd2hpY2hfZXNwczogWwogICAgICAgICIzMDpBRTpBNDo4NjpDMzoyMCIsCiAgICAgICAgIjMwOkFFOkE0Ojg2OkNBOjdDIiwKICAgICAgICAiIgogICAgICBdLAogICAgICBuYW1lOiAiIiwKICAgICAgY29tcG9uZW50S2V5OiAwCiAgICB9OwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gKCkgewogICAgICAgLy90aGlzLmdldF9zdGF0ZXMoIi9lc3AvdGVtcCIsIFtdLCAiIik7CiAgICAgICAvL3RoaXMuZ2V0X3N0YXRlcygiL2VzcC9saWdodCIsIFtdLCAiIik7CiAgICAgICB0aGlzLnByb2Nlc3NfZXNwKCk7CiAgICB9LAogIGNvbXBvbmVudHM6IHsKICAgIAogIH0sCiAgcHJvcHM6IHsKICAgIG1zZzogU3RyaW5nCiAgfSwKICBtb3VudGVkKCkge30sCgogIG1ldGhvZHM6IHsKICAgIHN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLndoaWNoX2VzcHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLmdldF9zdGF0ZXMoIi9lc3AvbGlnaHQiLCBbXSwgdGhpcy53aGljaF9lc3BzW2ldKTsKICAgICAgfQogICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMud2hpY2hfZXNwcy5sZW5ndGg7IGorKykgewogICAgICAgIHRoaXMuZ2V0X3N0YXRlcygiL2VzcC90ZW1wIiwgW10sIHRoaXMud2hpY2hfZXNwc1tqXSk7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgc3dpdGNoU3RhdGUod2gpIHsKICAgICAgdmFyIHVybCA9IHRoaXMubm9kZV91cmwgKyAiL2VzcC9sZWQiOwogICAgICB2YXIgbWVzc2FnZSA9ICJvbiI7CiAgICAgIHZhciBoZWFkZXIgPSBuZXcgSGVhZGVycygpOwogICAgICBoZWFkZXIuYXBwZW5kKCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgICBhd2FpdCBmZXRjaCh1cmwsIHsKICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICBoZWFkZXJzOiBoZWFkZXIsCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSwKICAgICAgICAgIHdobzogd2gKICAgICAgICB9KQogICAgICB9KTsKICAgIH0sCiAgICBwcm9jZXNzX2VzcCgpIHsKICAgICAgY29uc3QgcmVmcmVzaFQgPSA1MDAwOyAvLyBSZWZyZXNoIHBlcmlvZCBmb3IgY2hhcnQKICAgICAgdmFyIGVzcCA9ICIzMDpBRTpBNDo4NjpDQTo3QyI7CiAgICAgIC8vdmFyIGVzcCA9IHdoaWNoX2VzcHNbaV07IC8vIEwnRVNQICJhIGRlc3NpbmVyIgoKICAgICAgLy8gR2VzdGlvbiBkZSBsYSB0ZW1wZXJhdHVyZQogICAgICAvLyBwcmVtaWVyIGFwcGVsIHBvdXIgZXZpdGVyIGRlIGRldm9pciBhdHRlbmRyZSBSZWZyZXNoVAogICAgICB0aGlzLmdldF9zdGF0ZXMoIi9lc3AvdGVtcCIsMCwgZXNwKTsKICAgICAgLy9jYWxscyBhIGZ1bmN0aW9uIG9yIGV2YWx1YXRlcyBhbiBleHByZXNzaW9uIGF0IHNwZWNpZmllZAogICAgICAvL2ludGVydmFscyAoaW4gbWlsbGlzZWNvbmRzKS4KICAgICAgd2luZG93LnNldEludGVydmFsKAogICAgICAgIHRoaXMuZ2V0X3N0YXRlcywKICAgICAgICByZWZyZXNoVCwKICAgICAgICAiL2VzcC90ZW1wIiwgLy8gcGFyYW0gMSBmb3IgZ2V0X3NhbXBsZXMoKQogICAgICAgIDAsIC8vIHBhcmFtIDIgZm9yIGdldF9zYW1wbGVzKCkKICAgICAgICBlc3AKICAgICAgKTsgLy8gcGFyYW0gMyBmb3IgZ2V0X3NhbXBsZXMoKQoKICAgICAgLy8gR2VzdGlvbiBkZSBsYSBsdW1pZXJlCiAgICAgIHRoaXMuZ2V0X3N0YXRlcygiL2VzcC9saWdodCIsIDAsIGVzcCk7CiAgICAgIHdpbmRvdy5zZXRJbnRlcnZhbCgKICAgICAgICB0aGlzLmdldF9zdGF0ZXMsCiAgICAgICAgcmVmcmVzaFQsCiAgICAgICAgIi9lc3AvbGlnaHQiLCAvLyBVUkwgdG8gR0VUCiAgICAgICAgMCwgLy8gU2VyaWUgdG8gZmlsbAogICAgICAgIGVzcAogICAgICApOyAvLyBFU1AgdGFyZ2V0ZWQKICAgIH0sCiAgICBsYXN0VmFsdWUocGF0aCwgdmFsKXsKICAgICAgIGlmKHBhdGggPT0gIi9lc3AvdGVtcCIpewogICAgICAgICAgLy9kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGVtcCIpLmlubmVySFRNTCA9ICJMYSBUZW1ww6lyYXR1cmUgZXN0IGRlICIgKyB2YWwgKyAiwrBDIjsKICAgICAgICAgIHRoaXMubGFzdFRlbXAgPSAzNTsKICAgICAgIH0KICAgICAgIGlmKHBhdGggPT0gIi9lc3AvbGlnaHQiKXsKICAgICAgICAgIC8vZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxpZ2h0IikuaW5uZXJIVE1MID0gIkxhIEx1bWllcmUgZXN0IGRlICIgKyB2YWwgKyAiIGx1bWVuIjsKICAgICAgICAgIHRoaXMubGFzdEx1bWlub3NpdGUgPSB2YWw7CiAgICAgICB9CiAgICAgICB0aGlzLnRlc3QocGF0aCwgdmFsKTsKICAgICAgIGNvbnNvbGUubG9nKCJMYXN0ICIgKyBwYXRoICsgIiA6ICIgKyB2YWwpOwoKCiAgICB9LAoKICAgIGdldF9zdGF0ZXMocGF0aF9vbl9ub2RlLCBzZXJpZSwgd2gpIHsKCiAgICAgIHRoaXMubm9kZV91cmwgPSAiaHR0cDovL2xvY2FsaG9zdDozMDAwIjsKCiAgICAgIHZhciBsaXN0ZSA9IFtdCiAgICAgIHdoID0gIjMwOkFFOkE0Ojg2OkNBOjdDIjsKICAgICAgbGV0IHVybCA9IHRoaXMubm9kZV91cmwgKyBwYXRoX29uX25vZGUgKyAiP3dobz0iICsgd2g7CiAgICAgIGZldGNoKHVybCkKICAgICAgICAudGhlbihyZXNwb25zZUpTT04gPT4gewogICAgICAgICAgcmV0dXJuIHJlc3BvbnNlSlNPTi5qc29uKCk7CiAgICAgICAgfSkKICAgICAgICAudGhlbihyZXNwb25zZUpTID0+IHsKICAgICAgICAgIHRoaXMuaXRlbXMgPSByZXNwb25zZUpTOwoKICAgICAgICAgIGlmICh0aGlzLml0ZW1zKSB7CiAgICAgICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgICAgICAgICAgICBsaXN0ZS5wdXNoKFtEYXRlLnBhcnNlKGVsZW1lbnQuZGF0ZSksIGVsZW1lbnQudmFsdWVdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmxhc3RWYWx1ZShwYXRoX29uX25vZGUsKGxpc3RlWyhsaXN0ZS5sZW5ndGggLSAxKV1bMV0pKTsKCiAgICAgICAgfSk7CiAgICB9LAogICAgdGVzdChwYXRoLCB2YWwpewogICAgICAvL2NvbnNvbGUubG9nKCJ0ZXN0ICIgKyBwYXRoICsgIiA6ICIgKyB2YWwpOwoKICAgICAgaWYocGF0aCA9PSAiL2VzcC9saWdodCIgJiYgdmFsID49IDEwMDApewogICAgICAgIHRoaXMuZXRhdFZvbGV0ID0gIk91dmVydCI7CiAgICAgICAgY29uc29sZS5sb2coIk91dnJpciBwaXNjaW5lIik7CiAgICAgIH0KICAgICAgZWxzZSBpZiAocGF0aCA9PSAiL2VzcC9saWdodCIgJiYgdmFsIDwgMTAwMCl7CiAgICAgICAgdGhpcy5ldGF0Vm9sZXQgPSAiRmVybcOpIjsKICAgICAgICBjb25zb2xlLmxvZygiRmVybcOpIHBpc2NpbmUiKTsKICAgICAgfQogICAgICBpZihwYXRoID09ICIvZXNwL3RlbXAiICYmIHZhbCA+PSAyNil7CiAgICAgICAgYWxlcnQoIkFsbGV6IHZvdXMgYmFpZ25leiAhIik7CiAgICAgIH0KICAgIH0KCgoKICB9Cn07Cg=="},{"version":3,"sources":["Piscine.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA","file":"Piscine.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <h1> Bienvenue sur votre piscine </h1>\n    <div id=\"Piscine\">\n      <div class=\"contentPiscine\">\n        <p>Voici votre page Piscine.\n          Ici vous avez accès à la température de l'eau, ainsi que la luminosité ambiante.\n        </p>\n        <p>\n          Grâce aux boutons ci-dessous, vous pouvez fermer le volet de manière manuelle. Dans tous les cas, votre volet se ferme le soir quand la luminosité baisse, et il s'ouvre le matin au levé du soleil.\n          Le deuxième bouton permet d'allumer les lumières présentes aux alentours de votre piscine.\n        </p>\n      </div>\n      <div class=\"infoPiscine\">\n        <p id=\"temp\">Température de l'eau : <span id=\"valeur\">{{lastTemp}}</span> °C</p>\n        <p id=\"lum\">Luminosité : <span id=\"valeur\">{{lastLuminosite}}</span> Lum</p>\n\n      </div>\n    </div>\n    <div id=\"boutons\">\n      <div class=\"ledPiscine\">\n        <p> Lumières ambiante </p>\n        <md-button class=\"md-primary md-raised\" v-on:click=\"switchState('30:AE:A4:86:C3:20')\">Allumer la led</md-button>\n        <br>\n        <md-button class=\"md-primary md-raised\" v-on:click=\"switchState('30:AE:A4:86:C3:20')\">Eteindre la led</md-button>\n        <p> Etat de la lumière : {{etatLumiere}} </p>\n      </div>\n      <div class=\"voletPiscine\">\n        <p> Gestion du volet </p>\n        <md-button class=\"md-primary md-raised\" v-on:click=\"switchState('30:AE:A4:86:C3:20')\">Ouvrir la piscine</md-button>\n        <br>\n        <md-button class=\"md-primary md-raised\" v-on:click=\"switchState('30:AE:A4:86:C3:20')\">Fermer la piscine</md-button>\n        <p> Etat du volet : {{etatVolet}} </p>\n      </div>\n     </div> \n  </div>\n</template>\n\n\n<script>\n\nexport default {\n  name: \"Piscine\",\n  data() {\n    return {\n      states: [],\n      lastTemp: null,\n      lastLuminosite: null,\n      etatLumiere: \"Eteinte\",\n      etatVolet: \"Fermé\",\n      node_url: \"http://localhost:3000\",\n      which_esps: [\n        \"30:AE:A4:86:C3:20\",\n        \"30:AE:A4:86:CA:7C\",\n        \"\"\n      ],\n      name: \"\",\n      componentKey: 0\n    };\n  },\n  created: function () {\n       //this.get_states(\"/esp/temp\", [], \"\");\n       //this.get_states(\"/esp/light\", [], \"\");\n       this.process_esp();\n    },\n  components: {\n    \n  },\n  props: {\n    msg: String\n  },\n  mounted() {},\n\n  methods: {\n    start: function() {\n      for (var i = 0; i < this.which_esps.length; i++) {\n        this.get_states(\"/esp/light\", [], this.which_esps[i]);\n      }\n      for (var j = 0; j < this.which_esps.length; j++) {\n        this.get_states(\"/esp/temp\", [], this.which_esps[j]);\n      }\n    },\n\n    async switchState(wh) {\n      var url = this.node_url + \"/esp/led\";\n      var message = \"on\";\n      var header = new Headers();\n      header.append(\"Content-Type\", \"application/json\");\n      await fetch(url, {\n        method: \"POST\",\n        headers: header,\n        body: JSON.stringify({\n          message: message,\n          who: wh\n        })\n      });\n    },\n    process_esp() {\n      const refreshT = 5000; // Refresh period for chart\n      var esp = \"30:AE:A4:86:CA:7C\";\n      //var esp = which_esps[i]; // L'ESP \"a dessiner\"\n\n      // Gestion de la temperature\n      // premier appel pour eviter de devoir attendre RefreshT\n      this.get_states(\"/esp/temp\",0, esp);\n      //calls a function or evaluates an expression at specified\n      //intervals (in milliseconds).\n      window.setInterval(\n        this.get_states,\n        refreshT,\n        \"/esp/temp\", // param 1 for get_samples()\n        0, // param 2 for get_samples()\n        esp\n      ); // param 3 for get_samples()\n\n      // Gestion de la lumiere\n      this.get_states(\"/esp/light\", 0, esp);\n      window.setInterval(\n        this.get_states,\n        refreshT,\n        \"/esp/light\", // URL to GET\n        0, // Serie to fill\n        esp\n      ); // ESP targeted\n    },\n    lastValue(path, val){\n       if(path == \"/esp/temp\"){\n          //document.getElementById(\"temp\").innerHTML = \"La Température est de \" + val + \"°C\";\n          this.lastTemp = 35;\n       }\n       if(path == \"/esp/light\"){\n          //document.getElementById(\"light\").innerHTML = \"La Lumiere est de \" + val + \" lumen\";\n          this.lastLuminosite = val;\n       }\n       this.test(path, val);\n       console.log(\"Last \" + path + \" : \" + val);\n\n\n    },\n\n    get_states(path_on_node, serie, wh) {\n\n      this.node_url = \"http://localhost:3000\";\n\n      var liste = []\n      wh = \"30:AE:A4:86:CA:7C\";\n      let url = this.node_url + path_on_node + \"?who=\" + wh;\n      fetch(url)\n        .then(responseJSON => {\n          return responseJSON.json();\n        })\n        .then(responseJS => {\n          this.items = responseJS;\n\n          if (this.items) {\n            this.items.forEach(function(element) {\n                liste.push([Date.parse(element.date), element.value]);\n            });\n          }\n          this.lastValue(path_on_node,(liste[(liste.length - 1)][1]));\n\n        });\n    },\n    test(path, val){\n      //console.log(\"test \" + path + \" : \" + val);\n\n      if(path == \"/esp/light\" && val >= 1000){\n        this.etatVolet = \"Ouvert\";\n        console.log(\"Ouvrir piscine\");\n      }\n      else if (path == \"/esp/light\" && val < 1000){\n        this.etatVolet = \"Fermé\";\n        console.log(\"Fermé piscine\");\n      }\n      if(path == \"/esp/temp\" && val >= 26){\n        alert(\"Allez vous baignez !\");\n      }\n    }\n\n\n\n  }\n};\n</script>\n\n<style>\n\nh1{\n  font-size: 40px;\n}\n\n#temp, #lum{\n  background: #448aff;\n  padding:20px;\n  color:white;\n  border-radius: 5px;\n  margin-left: 5%;\n  margin-right: 5%;\n}\n\n#valeur{\n  font-weight: bold;\n}\n.contentPiscine{\n  font-size:20px;\n  float: left;\n  width: 50%;\n  padding-left: 5%;\n}\n.infoPiscine{\n  font-size: 20px;\n  float: right;\n  width: 50%;\n}\n\n.voletPiscine{\n  font-size: 25px;\n  margin-top: 5%;\n}\n.ledPiscine{\n  font-size: 25px;\n  margin-top: 20%\n}\n#boutons{\n  margin-top: 10%\n\n}\n\n</style>"]}]}